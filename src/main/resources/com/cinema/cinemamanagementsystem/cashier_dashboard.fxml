<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<BorderPane xmlns="http://javafx.com/javafx/17.0.2-ea"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.cinema.cinemamanagementsystem.controllers.CashierController"
            prefHeight="800.0" prefWidth="1200.0"
            styleClass="app-root">

    <top>
        <VBox spacing="10" styleClass="app-header">
            <HBox spacing="20" alignment="CENTER_LEFT">
                <VBox spacing="2">
                    <Label text="Кинотеатр 'КиноСфера'" styleClass="header-title">
                        <font>
                            <Font name="System Bold" size="20.0" />
                        </font>
                    </Label>
                    <Label text="Панель кассира" styleClass="header-subtitle"/>
                </VBox>

                <Pane HBox.hgrow="ALWAYS"/>

                <HBox spacing="14" alignment="CENTER_RIGHT">
                    <VBox spacing="2" alignment="CENTER_RIGHT">
                        <Label fx:id="welcomeLabel" text="Кассир:" styleClass="header-meta"/>
                        <Label fx:id="currentTimeLabel" styleClass="header-time"/>
                    </VBox>
                    <Button text="Выйти" onAction="#handleLogout" styleClass="button-danger"/>
                </HBox>
            </HBox>

            <MenuBar styleClass="app-menubar">
                <Menu text="Файл">
                    <MenuItem text="Выйти" onAction="#handleLogout"/>
                </Menu>
                <Menu text="Справка">
                    <MenuItem text="О программе"/>
                    <MenuItem text="Инструкция"/>
                </Menu>
            </MenuBar>
        </VBox>
    </top>

    <center>
        <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE" styleClass="main-tabs">
            <tabs>
                <Tab text="Продажа билетов">
                    <ScrollPane fitToWidth="true" styleClass="content-scroll">
                        <VBox spacing="12" styleClass="content-wrapper">
                            <HBox spacing="10" alignment="CENTER_LEFT" styleClass="toolbar">
                                <Label text="Дата" styleClass="section-title"/>
                                <DatePicker fx:id="datePicker" prefWidth="180"/>
                                <Label fx:id="totalSelectedLabel" text="Выбрано: 0 мест | Итого: 0.00 руб."
                                       styleClass="stat-chip"/>
                            </HBox>

                            <GridPane styleClass="compact-grid">
                                <columnConstraints>
                                    <ColumnConstraints percentWidth="66"/>
                                    <ColumnConstraints percentWidth="34"/>
                                </columnConstraints>

                                <VBox spacing="10" GridPane.columnIndex="0">
                                    <Label text="Фильмы и сеансы" styleClass="section-title"/>
                                    <VBox spacing="8" styleClass="card">
                                        <ScrollPane prefHeight="220" styleClass="content-scroll">
                                            <TilePane fx:id="filmsTilePane"
                                                      hgap="12" vgap="12"
                                                      prefTileWidth="230"
                                                      prefTileHeight="135"
                                                      styleClass="film-tiles"/>
                                        </ScrollPane>
                                    </VBox>

                                    <Label text="Сеанс" styleClass="section-title"/>
                                    <GridPane hgap="12" vgap="12">
                                        <columnConstraints>
                                            <ColumnConstraints percentWidth="40"/>
                                            <ColumnConstraints percentWidth="60"/>
                                        </columnConstraints>
                                        <VBox spacing="6" styleClass="card" GridPane.columnIndex="0">
                                            <Label fx:id="selectedFilmLabel" text="Фильм:" styleClass="info-label"/>
                                            <Label fx:id="selectedDateTimeLabel" text="Время:" styleClass="info-label"/>
                                            <Label fx:id="selectedHallLabel" text="Зал:" styleClass="info-label"/>
                                            <Label fx:id="selectedPriceLabel" text="Цена:" styleClass="info-label-accent"/>
                                        </VBox>
                                        <VBox spacing="8" styleClass="seat-card" GridPane.columnIndex="1">
                                            <Label text="Экран" styleClass="screen" alignment="CENTER"/>
                                            <GridPane fx:id="seatGrid" hgap="5" vgap="5" styleClass="seat-grid"/>
                                        </VBox>
                                    </GridPane>
                                </VBox>

                                <VBox spacing="10" GridPane.columnIndex="1">
                                    <VBox spacing="8" styleClass="sidebar-card">
                                        <Label text="Клиент" styleClass="section-title"/>
                                        <VBox spacing="4">
                                            <Label text="ФИО" styleClass="input-label"/>
                                            <TextField fx:id="customerNameField" promptText="Введите ФИО"/>
                                        </VBox>
                                        <VBox spacing="4">
                                            <Label text="Телефон" styleClass="input-label"/>
                                            <TextField fx:id="customerPhoneField" promptText="+7XXXXXXXXXX"/>
                                        </VBox>
                                        <VBox spacing="4">
                                            <Label text="Email (необязательно)" styleClass="input-label"/>
                                            <TextField fx:id="customerEmailField" promptText="email@example.com"/>
                                        </VBox>
                                    </VBox>

                                    <VBox spacing="8" styleClass="sidebar-card">
                                        <Label text="Тип операции" styleClass="section-title"/>
                                        <VBox spacing="6">
                                            <RadioButton fx:id="immediateSaleRadio" text="Немедленная продажа" selected="true"/>
                                            <RadioButton fx:id="bookingRadio" text="Бронирование на 15 минут"/>
                                        </VBox>
                                    </VBox>

                                    <VBox spacing="8" styleClass="sidebar-card">
                                        <Label fx:id="paymentMethodLabel" text="Способ оплаты" styleClass="section-title"
                                               visible="false" managed="false"/>
                                        <ComboBox fx:id="paymentMethodCombo" prefWidth="200"
                                                  visible="false" managed="false"/>
                                        <HBox spacing="10">
                                            <Button fx:id="sellTicketButton" text="ПРОДАТЬ"
                                                    styleClass="button-success" prefWidth="140" prefHeight="36"/>
                                            <Button fx:id="bookTicketButton" text="ЗАБРОНИРОВАТЬ"
                                                    styleClass="button-warning" prefWidth="160" prefHeight="36"/>
                                        </HBox>
                                        <VBox spacing="4" styleClass="hint-card">
                                            <Label text="Подсказка" styleClass="hint-title"/>
                                            <Label text="1. Дата → 2. Фильм и время → 3. Места → 4. Данные клиента"
                                                   styleClass="help-text" wrapText="true"/>
                                        </VBox>
                                    </VBox>
                                </VBox>
                            </GridPane>
                        </VBox>
                    </ScrollPane>
                </Tab>

                <Tab text="Бронирования">
                    <VBox spacing="12" styleClass="content-wrapper">
                        <HBox spacing="8" alignment="CENTER_LEFT">
                            <Label text="Активные бронирования" styleClass="section-title"/>
                            <Label text="(автообновление каждую минуту)" styleClass="help-text"/>
                        </HBox>

                        <TableView fx:id="bookingsTable" styleClass="card" prefHeight="400">
                            <columns>
                                <TableColumn fx:id="bookingIdColumn" text="№" prefWidth="50"/>
                                <TableColumn fx:id="bookingFilmColumn" text="Фильм" prefWidth="200"/>
                                <TableColumn fx:id="bookingTimeColumn" text="Время брони" prefWidth="120"/>
                                <TableColumn fx:id="bookingSeatColumn" text="Место" prefWidth="150"/>
                                <TableColumn fx:id="bookingCustomerColumn" text="Клиент" prefWidth="150"/>
                                <TableColumn fx:id="bookingStatusColumn" text="Статус" prefWidth="150"/>
                            </columns>
                        </TableView>

                        <HBox spacing="12">
                            <Button fx:id="confirmBookingButton" text="Подтвердить бронирование"
                                    styleClass="button-success" prefWidth="220"/>
                            <Button fx:id="cancelBookingButton" text="Отменить бронирование"
                                    styleClass="button-danger" prefWidth="220"/>
                        </HBox>
                    </VBox>
                </Tab>

                <Tab text="Клиенты">
                    <VBox spacing="12" styleClass="content-wrapper">
                        <HBox spacing="10">
                            <TextField fx:id="customerSearchField"
                                       promptText="Поиск по имени, телефону или email"
                                       prefWidth="320"/>
                            <Button fx:id="searchCustomerButton" text="Найти" styleClass="button-primary"/>
                        </HBox>

                        <TableView fx:id="customersTable" styleClass="card" prefHeight="500">
                            <columns>
                                <TableColumn fx:id="customerIdColumn" text="ID" prefWidth="50"/>
                                <TableColumn fx:id="customerNameColumn" text="ФИО" prefWidth="200"/>
                                <TableColumn fx:id="customerPhoneColumn" text="Телефон" prefWidth="150"/>
                                <TableColumn fx:id="customerVisitsColumn" text="Посещений" prefWidth="100"/>
                                <TableColumn fx:id="customerTotalColumn" text="Всего потрачено" prefWidth="140"/>
                            </columns>
                        </TableView>
                    </VBox>
                </Tab>

                <Tab text="Возвраты">
                    <VBox spacing="16" styleClass="content-wrapper">
                        <VBox spacing="12" styleClass="card">
                            <Label text="Оформление возврата" styleClass="section-title"/>

                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Номер билета:" prefWidth="120"/>
                                <TextField fx:id="refundTicketIdField" promptText="Введите номер билета" prefWidth="180"/>
                            </HBox>

                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Причина возврата:" prefWidth="120"/>
                                <TextField fx:id="refundReasonField" promptText="Укажите причину возврата" prefWidth="320"/>
                            </HBox>

                            <Button fx:id="refundButton" text="Оформить возврат" styleClass="button-danger" prefWidth="180"/>
                        </VBox>

                        <VBox spacing="10">
                            <Label text="Недавние продажи" styleClass="section-title"/>
                            <TableView fx:id="recentTicketsTable" styleClass="card" prefHeight="300"/>
                        </VBox>
                    </VBox>
                </Tab>
            </tabs>
        </TabPane>
    </center>

    <bottom>
        <HBox spacing="10" alignment="CENTER" styleClass="app-footer">
            <Label text="Статус: "/>
            <Label text="Готов к работе" styleClass="status-ready"/>
            <Pane HBox.hgrow="ALWAYS"/>
            <Label text="© 2025 Кинотеатр 'КиноСфера'. Версия 1.0"/>
        </HBox>
    </bottom>

</BorderPane>
